<!doctype html>
<html ng-app="baseballChant">
<head>
  <title>Baseball Chant</title>
  <style>
    .settings {
      background-color: white;
    }
    .hidden { visibility: hidden; }
    .chant {
      font-family: sans-serif;
      /* Font size depends on viewport size */
      font-size: 25vmin;
      font-weight: bolder;
      text-align: center;
      height: 100%;
      width: 100%;
      color: white;
      /* Using 4 shadow offsets to simulate text outline */
      text-shadow:
        -1px -1px 2px #000,
         1px -1px 2px #000,
        -1px  1px 2px #000,
         1px  1px 2px #000;
    }
  </style>
</head>
<body ng-controller="Chant as chant" ng-attr-style = "background-color: {{ chant.bg }}">
  <div ng-if="chant.settings" ng-class="'settings'">
    <h2>Settings</h2>
    <div>
      Words/parts:
      <input type="text" name="userName" ng-model="chant.a"></input>
      <input type="text" name="userName" ng-model="chant.b"></input>
      <input type="text" name="userName" ng-model="chant.c"></input>
      <input type="text" name="userName" ng-model="chant.d"></input>
      <input type="text" name="userName" ng-model="chant.e"></input>
    </div>
    <div>
      <input type="text" name="userName" ng-model="chant.beat"></input> Half-beat length in milliseconds
      <button ng-click="chant.StartInterval()">Restart Beat</button>
    </div>
    <div>
      <input type="text" name="userName" ng-model="chant.bg"></input> Background CSS color code
    </div>
    <div>
      <h3>Link for the above settings</h3>
      <a href="{{ chant.FullUrl() }}">{{ chant.FullUrl() }}</a>
      <div>Copy link or open in a new tab/window. Or you can refresh page after clicking, but settings options will disappear.</div>
    </div>
  </div>
  <div class="chant" ng-show="chant.currentBeat < 8">
    <div ng-class="{ 'hidden': chant.currentBeat < 0 }">
      {{ chant.a }}
    </div>
    <div ng-class="{ 'hidden': chant.currentBeat < 2 || chant.currentBeat > 8 }">
      {{ chant.b }}
    </div>
    <div>
      <span ng-class="{ 'hidden': chant.currentBeat < 4 || chant.currentBeat > 8 }">{{ chant.c }}</span><span ng-class="{ 'hidden': chant.currentBeat < 6 || chant.currentBeat > 8 }">{{ chant.d }}</span>
    </div>
  </div>
  <div class="chant"  ng-show="chant.currentBeat >= 8 && chant.currentBeat < 12">
    <div ng-class="{ 'hidden': chant.currentBeat < 8 }">
      &nbsp;
    </div>
    <div>
      <span ng-class="{ 'hidden': chant.currentBeat < 8 }">{{ chant.e }}</span>
      <span ng-class="{ 'hidden': chant.currentBeat < 10 }">{{ chant.e }}</span>
    </div>
    <div ng-class="{ 'hidden': chant.currentBeat < 10 }">
      &nbsp;
    </div>
  </div>
  <div class="chant" ng-show="chant.currentBeat >= 12">
    <div ng-class="{ 'hidden': chant.currentBeat < 12 }">
      {{ chant.e }}
    </div>
    <div ng-class="{ 'hidden': chant.currentBeat < 13 }">
      {{ chant.e }}
    </div>
    <div ng-class="{ 'hidden': chant.currentBeat < 14 }">
      {{ chant.e }}
    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.js"></script>
  <script>
    (function() {
      'use strict';

      angular
        .module('baseballChant', [])
        .controller('Chant', Chant);

      Chant.$inject = ['$interval', '$location'];

      function Chant($interval, $location) {
        var vm = this;
        vm.promise = null;
        vm.currentBeat = 0;

        // Grab values from url parameters if present
        vm.params = $location.search();
        vm.a = vm.params.a || "Let's";
        vm.b = vm.params.b || "Go";
        vm.c = vm.params.c || "Ran";
        vm.d = vm.params.d || "gers";
        vm.e = vm.params.e || "CLAP";
        vm.bg = vm.params.bg || "#003279";
        vm.beat = parseInt(vm.params.beat) || 200;
        vm.settings = vm.params.settings || false;

        // Advance beat count
        vm.NextBeat = function() {
          if (++vm.currentBeat >= 16) vm.currentBeat = 0;
        }

        vm.StartInterval = function() {
          vm.StopInterval();
          vm.promise = $interval(vm.NextBeat, vm.beat)
        }

        vm.StopInterval = function() {
          $interval.cancel(vm.promise);
        }

        vm.FullUrl = function() {
          return vm.BaseUrl()
            + '#?a=' + encodeURIComponent(vm.a)
            + '&b=' + encodeURIComponent(vm.b)
            + '&c=' + encodeURIComponent(vm.c)
            + '&d=' + encodeURIComponent(vm.d)
            + '&e=' + encodeURIComponent(vm.e)
            + '&bg=' + encodeURIComponent(vm.bg)
            + '&beat=' + encodeURIComponent(vm.beat);
        }

        // Returns the base file url
        vm.BaseUrl = function() {
          var pattern = /[#?]/
          return $location.absUrl().split(pattern, 1)[0];
        }

        // Start the beat!
        vm.StartInterval();
      }
    })();
  </script>
</body>
</html>
